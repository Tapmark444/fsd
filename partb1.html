<!DOCTYPE html>
<html>
<head>
    <title>Complaint Management</title>
</head>
<body>
    <h2>Complaint Management System</h2>

    <!-- SUBMIT -->
    <h3>Submit Complaint</h3>
    <form action="/complaints" method="POST">
        Name:
        <input type="text" name="userName" required><br><br>

        Issue:
        <input type="text" name="issue" required><br><br>

        <button type="submit">Submit</button>
    </form>

    <hr>

    <!-- UPDATE (PUT using fetch) -->
    <h3>Update Complaint Status</h3>
    Complaint ID:
    <input type="text" id="cid"><br><br>

    Status:
    <select id="status">
        <option>In Progress</option>
        <option>Resolved</option>
    </select><br><br>

    <button onclick="updateStatus()">Update Status</button>

    <hr>

    <!-- RETRIEVE -->
    <h3>All Complaints</h3>
    <button onclick="load()">Show All</button>
    <ul id="list"></ul>

    <script>
        function load() {
            fetch("/complaints")
                .then(res => res.json())
                .then(data => {
                    const list = document.getElementById("list");
                    list.innerHTML = "";
                    data.forEach(c => {
                        list.innerHTML +=
                          `<li>${c._id} | ${c.userName} | ${c.issue} | ${c.status}</li>`;
                    });
                });
        }

        function updateStatus() {
            const id = document.getElementById("cid").value;
            const status = document.getElementById("status").value;

            fetch("/complaints/" + id, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ status })
            })
            .then(res => res.json())
            .then(data => alert(data.message));
        }
    </script>
</body>
</html>
 <!-- <script>  
  /*  
  const express = require("express");
const { MongoClient, ObjectId } = require("mongodb");
const path = require("path");

const app = express();
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

const url = "mongodb://127.0.0.1:27017";
const client = new MongoClient(url);
let complaints;

/* MongoDB Connection */
async function connectDB() {
    await client.connect();
    complaints = client.db("complaintDB").collection("complaints");
    console.log("MongoDB connected");
}
connectDB();

/* =====================
   GET → Load HTML
   ===================== */
app.get("/", (req, res) => {
    res.sendFile(path.join(__dirname, "index.html"));
});

/* =====================
   POST → Submit Complaint
   ===================== */
app.post("/complaints", async (req, res) => {
    const { userName, issue } = req.body;

    await complaints.insertOne({
        userName,
        issue,
        status: "Pending"
    });

    res.redirect("/");
});

/* =====================
   PUT → Update Status
   ===================== */
app.put("/complaints/:id", async (req, res) => {
    const { status } = req.body;

    await complaints.updateOne(
        { _id: new ObjectId(req.params.id) },
        { $set: { status: status } }
    );

    res.json({ message: "Status Updated" });
});

/* =====================
   GET → Retrieve ALL Complaints
   ===================== */
app.get("/complaints", async (req, res) => {
    const data = await complaints.find().toArray();
    res.json(data);
});

app.listen(3000, () => {
    console.log("Server running on port 3000");
});

  
  </script> -->
</body>
</html>
